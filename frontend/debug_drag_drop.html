<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Drag and Drop</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .kanban-board {
            display: flex;
            gap: 20px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .column {
            width: 280px;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 16px;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        .column.drag-over {
            border: 2px dashed #3b82f6;
            background: #eff6ff;
        }
        .column-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 12px;
            color: #6b7280;
        }
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        .status-dot.todo { background: #6b7280; }
        .status-dot.doing { background: #f97316; }
        .status-dot.done { background: #22c55e; }
        .task-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: move;
            transition: all 0.2s;
        }
        .task-card:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .task-card.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }
        .task-title {
            font-weight: 500;
            color: #111827;
            margin-bottom: 4px;
        }
        .task-status {
            font-size: 11px;
            color: #6b7280;
            text-transform: uppercase;
        }
        .add-task-btn {
            width: 100%;
            padding: 8px;
            border: 1px dashed #d1d5db;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            color: #6b7280;
            font-size: 12px;
        }
        .add-task-btn:hover {
            background: #f9fafb;
            border-color: #9ca3af;
        }
        .logs {
            margin-top: 20px;
            background: #1f2937;
            color: #f9fafb;
            padding: 16px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .log-entry {
            margin-bottom: 4px;
        }
        .log-drag { color: #60a5fa; }
        .log-drop { color: #34d399; }
        .log-error { color: #f87171; }
        .log-info { color: #fbbf24; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste de Drag and Drop - Kanban</h1>
        <p>Arraste os cards entre as colunas para testar o funcionamento.</p>
        
        <div class="kanban-board" id="kanbanBoard">
            <div class="column" data-column="todo" id="column-todo">
                <div class="column-header">
                    <div class="status-dot todo"></div>
                    <span>PENDENTE</span>
                    <span class="task-count">(0)</span>
                </div>
                <div class="task-card" draggable="true" data-task-id="task-1" data-status="todo">
                    <div class="task-title">Tarefa de Teste 1</div>
                    <div class="task-status">todo</div>
                </div>
                <div class="task-card" draggable="true" data-task-id="task-2" data-status="todo">
                    <div class="task-title">Tarefa de Teste 2</div>
                    <div class="task-status">todo</div>
                </div>
                <button class="add-task-btn">+ Adicionar Tarefa</button>
            </div>
            
            <div class="column" data-column="doing" id="column-doing">
                <div class="column-header">
                    <div class="status-dot doing"></div>
                    <span>EM PROGRESSO</span>
                    <span class="task-count">(0)</span>
                </div>
                <button class="add-task-btn">+ Adicionar Tarefa</button>
            </div>
            
            <div class="column" data-column="done" id="column-done">
                <div class="column-header">
                    <div class="status-dot done"></div>
                    <span>CONCLU√çDA</span>
                    <span class="task-count">(0)</span>
                </div>
                <button class="add-task-btn">+ Adicionar Tarefa</button>
            </div>
        </div>
        
        <div class="logs" id="logs">
            <div class="log-entry log-info">üöÄ Sistema de drag and drop inicializado</div>
        </div>
    </div>

    <script>
        // Sistema de logs
        function log(message, type = 'info') {
            const logs = document.getElementById('logs');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = message;
            logs.appendChild(logEntry);
            logs.scrollTop = logs.scrollHeight;
            console.log(message);
        }

        // Mapeamento de status
        const statusMap = {
            'todo': 'pending',
            'doing': 'in_progress',
            'done': 'completed'
        };

        // Atualizar contadores
        function updateCounters() {
            document.querySelectorAll('.column').forEach(column => {
                const columnId = column.dataset.column;
                const taskCount = column.querySelectorAll('.task-card').length;
                const counter = column.querySelector('.task-count');
                counter.textContent = `(${taskCount})`;
            });
        }

        // Drag and Drop
        let draggedElement = null;
        let draggedColumn = null;

        // Eventos de drag
        document.querySelectorAll('.task-card').forEach(card => {
            card.addEventListener('dragstart', (e) => {
                draggedElement = e.target;
                draggedColumn = e.target.closest('.column');
                e.target.classList.add('dragging');
                
                const taskId = e.target.dataset.taskId;
                const status = e.target.dataset.status;
                
                log(`üöÄ [DRAG START] Iniciando drag da tarefa ${taskId} (${status})`, 'drag');
                
                // Salvar dados no dataTransfer
                e.dataTransfer.setData('text/plain', JSON.stringify({
                    taskId: taskId,
                    status: status,
                    sourceColumn: draggedColumn.dataset.column
                }));
            });

            card.addEventListener('dragend', (e) => {
                e.target.classList.remove('dragging');
                log(`üèÅ [DRAG END] Drag finalizado para ${e.target.dataset.taskId}`, 'drag');
            });
        });

        // Eventos de drop nas colunas
        document.querySelectorAll('.column').forEach(column => {
            column.addEventListener('dragover', (e) => {
                e.preventDefault();
                column.classList.add('drag-over');
                log(`üéØ [DRAG OVER] Sobre coluna ${column.dataset.column}`, 'drop');
            });

            column.addEventListener('dragleave', (e) => {
                if (!column.contains(e.relatedTarget)) {
                    column.classList.remove('drag-over');
                }
            });

            column.addEventListener('drop', (e) => {
                e.preventDefault();
                column.classList.remove('drag-over');
                
                const targetColumn = e.currentTarget.dataset.column;
                log(`üéØ [DROP] Soltando na coluna ${targetColumn}`, 'drop');
                
                try {
                    const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                    const { taskId, status, sourceColumn } = data;
                    
                    log(`üìã [DROP] Dados: ${taskId} de ${sourceColumn} para ${targetColumn}`, 'info');
                    
                    if (sourceColumn === targetColumn) {
                        log(`‚ö†Ô∏è [DROP] Mesma coluna, ignorando`, 'info');
                        return;
                    }
                    
                    // Simular movimento da tarefa
                    const taskElement = document.querySelector(`[data-task-id="${taskId}"]`);
                    if (taskElement) {
                        // Remover da coluna origem
                        taskElement.remove();
                        
                        // Adicionar √† coluna destino (antes do bot√£o)
                        const addButton = column.querySelector('.add-task-btn');
                        column.insertBefore(taskElement, addButton);
                        
                        // Atualizar status
                        const newStatus = statusMap[targetColumn] || targetColumn;
                        taskElement.dataset.status = newStatus;
                        taskElement.querySelector('.task-status').textContent = newStatus;
                        
                        // Atualizar contadores
                        updateCounters();
                        
                        log(`‚úÖ [DROP] Tarefa ${taskId} movida de ${sourceColumn} para ${targetColumn}`, 'drop');
                        log(`üíæ [DROP] Status atualizado para: ${newStatus}`, 'info');
                    }
                } catch (error) {
                    log(`‚ùå [DROP] Erro ao processar drop: ${error.message}`, 'error');
                }
            });
        });

        // Inicializar
        updateCounters();
        log('‚úÖ Sistema de drag and drop carregado com sucesso!', 'info');
        log('üéÆ Arraste os cards entre as colunas para testar', 'info');
    </script>
</body>
</html>
